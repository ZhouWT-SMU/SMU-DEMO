<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>场景宝</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>

<body>
<div class="login-overlay" id="authOverlay">
    <div class="login-card">
        <h2>企业用户登录</h2>
        <p class="login-subtitle">登录后可使用智能对话、能力上传与审批结果查询，账号信息仅用于演示。</p>
        <form id="loginForm" class="login-form">
            <label for="username">用户名</label>
            <input id="username" name="username" type="text" placeholder="enterprise" required>

            <label for="password">密码</label>
            <input id="password" name="password" type="password" placeholder="示例：enterprise123" required>

            <div class="login-actions">
                <button type="submit" class="primary-btn">登录</button>
                <div class="login-help">
                    <p><strong>企业用户：</strong>enterprise / enterprise123</p>
                    <p>审批中心请从左侧菜单进入并单独登录。</p>
                </div>
            </div>
            <div id="loginMessage" class="form-result"></div>
        </form>
    </div>
</div>

<div class="login-overlay hidden" id="adminAuthOverlay">
    <div class="login-card">
        <h2>审批中心登录</h2>
        <p class="login-subtitle">仅管理员可登录审批中心，点击右上角可关闭并暂不登录。</p>
        <button class="ghost-btn overlay-close" id="closeAdminOverlay" aria-label="关闭管理员登录">×</button>
        <form id="adminLoginForm" class="login-form">
            <label for="adminUsername">用户名</label>
            <input id="adminUsername" name="username" type="text" placeholder="admin" required>

            <label for="adminPassword">密码</label>
            <input id="adminPassword" name="password" type="password" placeholder="示例：admin123" required>

            <div class="login-actions">
                <button type="submit" class="primary-btn">登录</button>
                <button type="button" class="ghost-btn" id="skipAdminLogin">暂不登录</button>
                <div class="login-help">
                    <p><strong>管理员：</strong>admin / admin123</p>
                    <p>不登录则无法操作审批功能。</p>
                </div>
            </div>
            <div id="adminLoginMessage" class="form-result"></div>
        </form>
    </div>
</div>
<div class="app-shell">
    <aside class="sidebar">
        <div class="brand">
            <div class="brand-icon brand-logo" aria-label="究模智科技标识"></div>
            <div class="brand-text">
                <h1>场景宝</h1>
                <p>科技驱动业务场景落地</p>
            </div>
        </div>
        <nav class="menu">
            <button class="menu-item active" data-target="chatModule" data-title="智能对话中台"
                    data-description="与企业智能助手实时沟通，获取政策、能力和服务建议。">
                <span class="menu-icon" aria-hidden="true">🤖</span>
                <span class="menu-label">智能对话</span>
            </button>
            <button class="menu-item" data-target="capabilityModule" data-title="企业能力上传"
                    data-description="集中管理企业能力信息，便于平台审核、推介和匹配。" data-role-visible="ENTERPRISE">
                <span class="menu-icon" aria-hidden="true">📤</span>
                <span class="menu-label">企业能力上传</span>
            </button>
            <button class="menu-item" data-target="resultModule" data-title="审批结果查询"
                    data-description="独立查看每次能力提交的审核状态与反馈。" data-role-visible="ENTERPRISE">
                <span class="menu-icon" aria-hidden="true">📑</span>
                <span class="menu-label">审批结果查询</span>
            </button>
            <button class="menu-item" data-target="approvalModule" data-title="审批中心"
                    data-description="管理员登录后查看、处理企业能力提交并导出列表。" data-requires-admin="true">
                <span class="menu-icon" aria-hidden="true">📝</span>
                <span class="menu-label">审批中心</span>
            </button>
        </nav>
        <div class="sidebar-footer">
            <div class="footer-tip">
                <h3>操作提示</h3>
                <p>在左侧选择功能模块，右侧区域将展示对应的业务界面。</p>
                <p>审批中心支持登录后导出企业能力列表。</p>
            </div>
        </div>
    </aside>

    <main class="content">
        <header class="content-header">
            <div class="header-copy">
                <h2 id="moduleTitle">智能对话中台</h2>
                <p id="moduleDescription">与企业智能助手实时沟通，获取政策、能力和服务建议。</p>
            </div>
            <div class="status-cluster">
                <div class="status-group">
                    <div class="user-status" id="userStatus">企业账号：未登录</div>
                    <button class="ghost-btn" id="logoutUser" aria-label="退出企业登录">退出企业</button>
                </div>
                <div class="status-group hidden" id="adminControls">
                    <div class="user-status" id="adminStatus">管理员账号：未登录</div>
                    <button class="ghost-btn" id="openAdminLogin" aria-label="打开管理员登录">管理员登录</button>
                    <button class="ghost-btn" id="logoutAdmin" aria-label="退出管理员登录">退出管理员</button>
                </div>
            </div>
        </header>

        <section id="chatModule" class="module active" aria-labelledby="moduleTitle">
            <div class="module-grid">
                <div class="chat-workspace">
                    <aside class="conversation-history" data-conversation-history data-conversation-key="primary-chat">
                        <div class="history-header">
                            <div>
                                <p class="history-title">历史对话</p>
                                <p class="history-subtitle">快速回顾最近提问</p>
                            </div>
                            <button type="button" class="ghost-btn" data-conversation-new>新建对话</button>
                        </div>
                        <div class="history-list" data-history-list>
                            <div class="history-empty">暂无历史对话</div>
                        </div>
                    </aside>

                    <div class="chat-panel" data-chat data-conversation-key="primary-chat" data-user-label="我" data-assistant-label="智能助手"
                         data-reply-template="已记录您的需求“{message}”。我们将结合企业画像为您准备相应的服务建议。">
                        <div class="chat-header">
                            <h3>智能对话助手</h3>
                            <span class="chat-status">在线</span>
                        </div>
                        <div class="chat-history" data-chat-history aria-live="polite">
                            <div class="message assistant">
                                <div class="message-meta">智能助手</div>
                                <div class="message-body">您好！我是企业智能助手，可以为您提供政策解读、项目申报、资源对接等服务。</div>
                            </div>
                        </div>
                        <div class="chat-suggestions" aria-label="快捷提问">
                            <button type="button" class="suggestion" data-chat-suggestion data-text="我们企业想了解产业扶持政策。">产业扶持政策</button>
                            <button type="button" class="suggestion" data-chat-suggestion data-text="请帮我推荐适合的合作伙伴。">合作伙伴推荐</button>
                            <button type="button" class="suggestion" data-chat-suggestion data-text="想了解数字化升级方案。">数字化升级方案</button>
                        </div>
                        <div class="chat-input-area">
                                <textarea data-chat-input placeholder="请输入您的问题，按 Enter 发送，Shift+Enter 换行" rows="2"
                                          aria-label="对话输入"></textarea>
                            <button type="button" class="primary-btn" data-chat-send>发送</button>
                        </div>
                    </div>
                </div>
                <aside class="insight-panel" aria-label="对话辅助信息">
                    <h3>推荐话题</h3>
                    <ul>
                        <li>企业诊断报告</li>
                        <li>融资渠道咨询</li>
                        <li>政策申报材料准备</li>
                        <li>人才引进计划</li>
                    </ul>
                    <div class="insight-card">
                        <h4>最新通知</h4>
                        <p>2024 年数字经济专项扶持政策启动报名，欢迎符合条件的企业提交申请。</p>
                    </div>
                </aside>
            </div>
        </section>

        <section id="capabilityModule" class="module" aria-labelledby="moduleTitle">
            <div class="capability-layout">
                <form id="capabilityForm" class="capability-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="companyName">企业名称</label>
                            <input id="companyName" name="companyName" type="text" placeholder="请输入企业全称" required>
                        </div>
                        <div class="form-group">
                            <label for="creditCode">社会统一信用代码</label>
                            <input id="creditCode" name="creditCode" type="text" placeholder="913XXXXXXXXXXXXX" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="companyScale">企业规模</label>
                            <select id="companyScale" name="companyScale" required>
                                <option value="" disabled selected>请选择企业规模</option>
                                <option value="大型企业">大型企业</option>
                                <option value="中型企业">中型企业</option>
                                <option value="小型企业">小型企业</option>
                                <option value="初创企业">初创企业</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="companyType">企业类型</label>
                            <select id="companyType" name="companyType" required>
                                <option value="" disabled selected>请选择企业类型</option>
                                <option value="民营企业">民营企业</option>
                                <option value="国有企业">国有企业</option>
                                <option value="合资企业">合资企业</option>
                                <option value="外资企业">外资企业</option>
                                <option value="其他">其他</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="companyAddress">企业地址</label>
                            <input id="companyAddress" name="companyAddress" type="text" placeholder="请输入企业总部所在地" required>
                        </div>
                        <div class="form-group">
                            <label for="businessIntro">业务简介</label>
                            <textarea id="businessIntro" name="businessIntro" placeholder="简要描述主营业务及核心优势" rows="4"
                                      required></textarea>
                        </div>
                    </div>

                    <div class="form-group full-width">
                        <label>核心产品 <span class="optional">（可增加）</span></label>
                        <div class="dynamic-list" id="coreProductsList" data-name="coreProducts[]" data-placeholder="请输入核心产品">
                            <div class="dynamic-item">
                                <input type="text" name="coreProducts[]" placeholder="请输入核心产品" required>
                                <button type="button" class="remove-item" aria-label="删除核心产品">×</button>
                            </div>
                        </div>
                        <button type="button" class="add-item" data-target="coreProductsList">+ 添加核心产品</button>
                    </div>

                    <div class="form-group full-width">
                        <label>知识产权 <span class="optional">（可增加）</span></label>
                        <div class="dynamic-list" id="intellectualPropertiesList" data-name="intellectualProperties[]"
                             data-placeholder="请输入知识产权名称或编号">
                            <div class="dynamic-item">
                                <input type="text" name="intellectualProperties[]" placeholder="请输入知识产权名称或编号">
                                <button type="button" class="remove-item" aria-label="删除知识产权">×</button>
                            </div>
                        </div>
                        <button type="button" class="add-item" data-target="intellectualPropertiesList">+ 添加知识产权</button>
                    </div>

                    <div class="form-group full-width">
                        <label>专利 <span class="optional">（可增加）</span></label>
                        <div class="dynamic-list" id="patentList" data-name="patents[]" data-placeholder="请输入专利名称或编号">
                            <div class="dynamic-item">
                                <input type="text" name="patents[]" placeholder="请输入专利名称或编号">
                                <button type="button" class="remove-item" aria-label="删除专利">×</button>
                            </div>
                        </div>
                        <button type="button" class="add-item" data-target="patentList">+ 添加专利</button>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="contactName">联系人姓名</label>
                            <input id="contactName" name="contactName" type="text" placeholder="请输入联系人姓名" required>
                        </div>
                        <div class="form-group">
                            <label for="contactInfo">联系方式</label>
                            <input id="contactInfo" name="contactInfo" type="text" placeholder="手机号或邮箱" required>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="primary-btn">提交能力信息</button>
                        <button type="reset" class="secondary-btn">清空表单</button>
                    </div>
                    <div id="formResult" class="form-result" aria-live="polite"></div>
                </form>

                <aside class="capability-side" aria-label="辅助模块">
                    <div class="assistant-support" aria-label="资料准备提示">
                        <div class="assistant-intro">
                            <h3>填写遇到问题？</h3>
                            <p>参考右侧资料准备要点，提前确认内容齐全，提升提交流程效率。</p>
                        </div>
                        <div class="guidance-grid">
                            <div class="insight-card">
                                <h4>资料准备清单</h4>
                                <ul class="tip-list">
                                    <li>企业统一社会信用代码复印件（加盖公章）。</li>
                                    <li>最新年度的财务报表或审计报告。</li>
                                    <li>核心产品及解决方案的简介与案例。</li>
                                    <li>知识产权、专利、商标等证明材料。</li>
                                    <li>主营业务合同或合作证明（可选）。</li>
                                </ul>
                            </div>
                            <div class="insight-card">
                                <h4>填写小贴士</h4>
                                <ul class="tip-list">
                                    <li>业务简介尽量量化成果，例如营收增长、客户覆盖率。</li>
                                    <li>核心产品描述突出优势、关键技术与典型客户。</li>
                                    <li>知识产权信息请填写授权编号与获批时间，便于核验。</li>
                                    <li>联系方式建议使用常用手机号或邮箱，确保及时沟通。</li>
                                </ul>
                            </div>
                            <div class="insight-card">
                                <h4>审核时间参考</h4>
                                <p>资料提交后，平台通常在 <strong>3-5 个工作日</strong> 内完成审核并反馈结果。若需加急处理，可在备注中标明时间节点。</p>
                            </div>
                        </div>
                    </div>

                </aside>
            </div>
        </section>

        <section id="resultModule" class="module" aria-labelledby="moduleTitle">
            <div class="result-shell">
                <div class="result-head">
                    <div>
                        <p class="eyebrow">审批结果查询</p>
                        <h3>提交列表</h3>
                        <p class="muted">按时间倒序展示最近的审批记录，随时查看审批人、理由与统一信用代码。</p>
                    </div>
                    <div class="result-pills">
                        <div class="pill-stat" data-status="pending">
                            <span class="pill-label">待审核</span>
                            <strong id="historyPending">0</strong>
                        </div>
                        <div class="pill-stat" data-status="approved">
                            <span class="pill-label">已通过</span>
                            <strong id="historyApproved">0</strong>
                        </div>
                        <div class="pill-stat" data-status="rejected">
                            <span class="pill-label">已拒绝</span>
                            <strong id="historyRejected">0</strong>
                        </div>
                    </div>
                </div>

                <div class="result-list-panel" id="uploadHistoryPanel" aria-live="polite">
                    <div class="panel-header">
                        <div>
                            <p class="history-title">提交列表</p>
                            <p class="history-subtitle">按提交时间倒序展示</p>
                        </div>
                        <div class="panel-actions">
                            <button type="button" class="ghost-btn" id="refreshUploadHistory">刷新列表</button>
                        </div>
                    </div>
                    <div class="result-list-helper">
                        <span>温馨提示：</span>
                        <p>卡片展示审批状态、审批人姓名与理由，支持滚动查看更多历史记录。</p>
                    </div>
                    <div id="uploadHistoryList" class="result-list">
                        <div class="history-empty">登录后可查看上传记录</div>
                    </div>
                </div>
            </div>
        </section>

        <section id="approvalModule" class="module" aria-labelledby="moduleTitle">
            <div id="approvalLockedState" class="approval-locked">
                <div class="lock-icon" aria-hidden="true">🔒</div>
                <div>
                    <h3>需要管理员身份</h3>
                    <p class="muted">请使用管理员账号登录后查看并处理提交列表。</p>
                </div>
                <button type="button" class="primary-btn" id="openAdminFromLock">管理员登录</button>
            </div>
            <div class="approval-layout hidden" id="approvalContent">
                <div class="approval-header">
                    <div>
                        <h3>能力提交审批</h3>
                        <p class="muted">管理员登录后可查看、同意或拒绝企业提交，并支持导出列表。</p>
                    </div>
                    <div class="approval-actions-bar">
                        <button type="button" class="icon-btn" id="exportSubmissions" title="导出能力企业列表">
                            <span aria-hidden="true">📥</span><span>导出xlsx</span>
                        </button>
                    </div>
                </div>

                <div id="approvalMessage" class="form-result"></div>

                <div class="approval-stats" id="approvalStats">
                    <div class="stat-card" data-status="pending">
                        <p>待审核</p>
                        <strong id="statPending">0</strong>
                    </div>
                    <div class="stat-card" data-status="approved">
                        <p>已通过</p>
                        <strong id="statApproved">0</strong>
                    </div>
                    <div class="stat-card" data-status="rejected">
                        <p>已拒绝</p>
                        <strong id="statRejected">0</strong>
                    </div>
                </div>

                <div class="approval-grid">
                    <div class="approval-list-panel">
                        <div class="panel-header">
                            <div>
                                <p class="history-title">提交列表</p>
                                <p class="history-subtitle">按提交时间倒序展示</p>
                            </div>
                            <div class="panel-actions">
                                <button type="button" class="ghost-btn" id="refreshSubmissions">刷新列表</button>
                            </div>
                        </div>
                        <div id="approvalList" class="approval-list" aria-live="polite">
                            <div class="history-empty">点击上方按钮登录管理员后查看提交记录</div>
                        </div>
                    </div>
                    <div class="approval-detail-panel">
                        <div class="panel-header">
                            <div>
                                <p class="history-title">详情预览</p>
                                <p class="history-subtitle">点击左侧卡片查看具体内容</p>
                            </div>
                        </div>
                        <div id="approvalDetail" class="approval-detail" hidden></div>
                    </div>
                </div>
            </div>
        </section>

    </main>
</div>

<div class="modal-overlay hidden" id="uploadSuccessModal" role="alertdialog" aria-modal="true">
    <div class="modal-card">
        <div class="modal-icon">✅</div>
        <h3>上传成功</h3>
        <p>资料已提交，请等待管理员审核结果。</p>
        <div class="modal-actions">
            <button type="button" class="primary-btn" id="closeUploadModal">好的</button>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="script.js"></script>
</body>

</html>